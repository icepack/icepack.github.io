

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Meshes, functions &mdash; icepack 0.0.3 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Synthetic ice shelf" href="icepack.demo.01-synthetic-ice-shelf.html" />
    <link rel="prev" title="Contact" href="contact.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> icepack
          

          
          </a>

          
            
            
              <div class="version">
                0.0.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Basics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="background.html">Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Contact</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Meshes, functions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#meshes">Meshes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#functions">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#post-processing">Post-processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="icepack.demo.01-synthetic-ice-shelf.html">Synthetic ice shelf</a></li>
<li class="toctree-l1"><a class="reference internal" href="icepack.demo.02-larsen-ice-shelf.html">Larsen Ice Shelf</a></li>
<li class="toctree-l1"><a class="reference internal" href="icepack.demo.03-synthetic-ice-stream.html">Synthetic ice stream</a></li>
<li class="toctree-l1"><a class="reference internal" href="icepack.demo.04-ice-shelf-inverse.html">Inverse problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="icepack.demo.05-hybrid-ice-stream.html">Ice streams, once more</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="design.html">Design</a></li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="modules.html">icepack</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">icepack</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Meshes, functions</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/icepack.demo.00-meshes-functions.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">firedrake</span>
<span class="kn">import</span> <span class="nn">icepack</span><span class="o">,</span> <span class="nn">icepack.plot</span>
</pre></div>
</div>
<div class="section" id="meshes-functions">
<h1>Meshes, functions<a class="headerlink" href="#meshes-functions" title="Permalink to this headline">¶</a></h1>
<p>This demo will show you how to create a simple mesh, define a function
on that mesh, and postprocess the results. A function on a domain can be
defined analytically by getting some handles for the x- and
y-coordinates of the points of the domain, and manipulating the
coordinate functions algebraically. Firedrake includes some routines for
plotting functions defined on unstructured meshes so we can visualize
the results. Finally, we’ll demonstrate the possibilities for how to
analyze a function by evaluating some area and contour integrals.</p>
<div class="section" id="meshes">
<h2>Meshes<a class="headerlink" href="#meshes" title="Permalink to this headline">¶</a></h2>
<p>First, we need to make a mesh. Firedrake includes routines for
generating meshes of simple domains; to see all of the meshes that are
available, you can type</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">firedrake</span><span class="o">.</span><span class="n">utility_meshes</span><span class="p">)</span>
</pre></div>
</div>
<p>from the python interpreter. In this demo we’ll use a mesh of the unit
square.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span>
<span class="n">mesh</span> <span class="o">=</span> <span class="n">firedrake</span><span class="o">.</span><span class="n">UnitSquareMesh</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span>
</pre></div>
</div>
<p>Mesh plots are shown with a different color for each segments of the
boundary and a legend. This is useful to when applying different
boundary conditions to different segments, for example, Dirichlet
boundary conditions on part of the domain and Neumann boundary
conditions on the other part.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">icepack</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">icepack</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">triplot</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/icepack.demo.00-meshes-functions_5_0.png" src="_images/icepack.demo.00-meshes-functions_5_0.png" />
</div>
<div class="section" id="functions">
<h2>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h2>
<p>We can make scalar and vector fields defined on this mesh by
interpolating the values of an algebraic expression to some space of
functions.</p>
<p>First, we have to construct a function space <code class="docutils literal notranslate"><span class="pre">Q</span></code>. We already have a
mesh, and we need to decide what element family and polynomial degree.
In almost all the cases you’ll encounter, the element family consists of
continuous piecewise-polynomial functions in each triangle, which is
abbreviated to <code class="docutils literal notranslate"><span class="pre">CG</span></code> for “continuous Galerkin”.</p>
<p>Next, we have to make an expression for the function and interpolate it
to the function space <code class="docutils literal notranslate"><span class="pre">Q</span></code>. The function
<code class="docutils literal notranslate"><span class="pre">firedrake.SpatialCoordinate</span></code> returns two symbolic objects <code class="docutils literal notranslate"><span class="pre">x</span></code>,
<code class="docutils literal notranslate"><span class="pre">y</span></code> for the coordinates of each point of the mesh. We can then use
these symbols to define expressions for the function we’d like to
analyze. In this case, I’ve chosen the <a class="reference external" href="https://en.wikipedia.org/wiki/Rosenbrock_function">Rosenbrock
function</a>.
Firedrake has built-in functions for evaluating various transcendental
functions of the coordinates, for example the sine, cosine, exponential,
logarithm, etc. To see all of the available functions, you can check the
namespace <code class="docutils literal notranslate"><span class="pre">ufl.operators</span></code>.</p>
<p>Finally, the function <code class="docutils literal notranslate"><span class="pre">firedrake.interpolate</span></code> takes in an expression
and a function space, and returns a field from that function space.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">degree</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">Q</span> <span class="o">=</span> <span class="n">firedrake</span><span class="o">.</span><span class="n">FunctionSpace</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="s1">&#39;CG&#39;</span><span class="p">,</span> <span class="n">degree</span><span class="p">)</span>

<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">firedrake</span><span class="o">.</span><span class="n">SpatialCoordinate</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>
<span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">10.0</span>
<span class="n">expr</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">firedrake</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">Q</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">icepack</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">contours</span> <span class="o">=</span> <span class="n">icepack</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">tricontourf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">contours</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/icepack.demo.00-meshes-functions_7_0.png" src="_images/icepack.demo.00-meshes-functions_7_0.png" />
<p>We can make vector fields in much the same way as we make scalar fields,
the only difference being the type of function space. There are many
ways to plot a vector field. Here we show a plot of the streamlines of
the vector field, colored according to the magnitude of the vector. This
method is expensive, especially if you set the resolution or spacing of
the streamlines to be too small, but nonetheless it produces really nice
graphics.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">V</span> <span class="o">=</span> <span class="n">firedrake</span><span class="o">.</span><span class="n">VectorFunctionSpace</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="s1">&#39;CG&#39;</span><span class="p">,</span> <span class="n">degree</span><span class="p">)</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">firedrake</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">firedrake</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">expr</span><span class="p">),</span> <span class="n">V</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">icepack</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">opts</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;precision&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="o">/</span><span class="mi">128</span><span class="p">,</span> <span class="s1">&#39;density&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="o">/</span><span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;max_num_points&#39;</span><span class="p">:</span> <span class="mi">128</span><span class="p">}</span>
<span class="n">streamlines</span> <span class="o">=</span> <span class="n">icepack</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">streamplot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">streamlines</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/icepack.demo.00-meshes-functions_9_0.png" src="_images/icepack.demo.00-meshes-functions_9_0.png" />
</div>
<div class="section" id="post-processing">
<h2>Post-processing<a class="headerlink" href="#post-processing" title="Permalink to this headline">¶</a></h2>
<p>We’ve already seen about how to visualize a scalar or a vector field;
this is just a call to the function <code class="docutils literal notranslate"><span class="pre">icepack.plot</span></code>. To analyze the
results of a simulation, you might also want to evaluate scalar or
vector fields at points in the domain:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">q</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">v</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="mf">2.5153490401663703e-17</span>
<span class="p">[</span> <span class="mf">3.46901282e-15</span> <span class="o">-</span><span class="mf">2.52175273e-15</span><span class="p">]</span>
</pre></div>
</div>
<p>Firedrake also provides a rich set of operations for evaluating integral
expressions of scalar and vector fields. Much like how the function
<code class="docutils literal notranslate"><span class="pre">SpatialCoordinate</span></code> gives you two symbols <code class="docutils literal notranslate"><span class="pre">x</span></code>, <code class="docutils literal notranslate"><span class="pre">y</span></code> that represent
the coordinates of each point of the mesh, firedrake also provides an
object <code class="docutils literal notranslate"><span class="pre">dx</span></code> that represents the differential area element.</p>
<p>To define an integral, we multiply an expression by <code class="docutils literal notranslate"><span class="pre">dx</span></code>, and then
call the function <code class="docutils literal notranslate"><span class="pre">firedrake.assemble</span></code> to evaluate it.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">firedrake</span> <span class="k">import</span> <span class="n">inner</span><span class="p">,</span> <span class="n">grad</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">assemble</span>

<span class="nb">print</span><span class="p">(</span><span class="n">assemble</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="o">*</span><span class="n">dx</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">assemble</span><span class="p">(</span><span class="n">q</span><span class="o">*</span><span class="n">dx</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">assemble</span><span class="p">(</span><span class="n">inner</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">0.25000000000000006</span>
<span class="mf">2.0833346048990866</span>
<span class="mf">172.0160966979131</span>
</pre></div>
</div>
<p>We can also evaluate integrals over the boundary of the mesh. Boundary
integrals are specified using the differential surface element <code class="docutils literal notranslate"><span class="pre">ds</span></code>
instead of <code class="docutils literal notranslate"><span class="pre">dx</span></code>.</p>
<p>Sometimes we need to integrate over only part of the boundary. We can
specify which part by passing the right numeric ID to <code class="docutils literal notranslate"><span class="pre">ds</span></code>; these are
the same IDs that are color-coded in the mesh plot above.</p>
<p>Finally, you might also want to evaluate the flux of a vector field
across the boundary. To evaluate a flux, we need to get the unit outward
normal vector to the boundary. You can get a symbol representing the
unit outward normal by calling the function <code class="docutils literal notranslate"><span class="pre">firedrake.FacetNormal</span></code>.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">firedrake</span> <span class="k">import</span> <span class="n">ds</span>

<span class="nb">print</span><span class="p">(</span><span class="n">assemble</span><span class="p">(</span><span class="n">q</span><span class="o">*</span><span class="n">ds</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">assemble</span><span class="p">(</span><span class="n">q</span><span class="o">*</span><span class="n">ds</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>

<span class="n">n</span> <span class="o">=</span> <span class="n">firedrake</span><span class="o">.</span><span class="n">FacetNormal</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">assemble</span><span class="p">(</span><span class="n">inner</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">ds</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">14.666669209798183</span>
<span class="mf">3.583333333333335</span>
<span class="mf">42.000000000000014</span>
</pre></div>
</div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>Icepack uses the functions in firedrake to implement solvers for the
various physics problems that show up in ice sheet modeling. The
firedrake routines that we’ve demonstrated here can be used for
analyzing simulation results, either through visualization, evaluating
fields at points, or evaluating integrals of fields. They can also be
used to define input fields of simulations, if those fields have a
simple analytical expression. In the next demo, we’ll show how to use
icepack to solve for the velocity and thickness of a floating ice shelf
with a synthetic geometry. In later demos, we’ll show how to use real
observational data sets, as well as more complicated geometries imported
from mesh generators.</p>
<p>To read more about firedrake, you can visit their
<a class="reference external" href="http://www.firedrakeproject.org/documentation.html">documentation</a>
or check out some of the
<a class="reference external" href="http://www.firedrakeproject.org/notebooks.html">demos</a>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="icepack.demo.01-synthetic-ice-shelf.html" class="btn btn-neutral float-right" title="Synthetic ice shelf" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="contact.html" class="btn btn-neutral float-left" title="Contact" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Daniel Shapero

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>